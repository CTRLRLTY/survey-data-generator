(self.webpackChunkSurveyGenerator=self.webpackChunkSurveyGenerator||[]).push([[179],{138:(e,t,n)=>{const{convertArrayToCSV:o}=n(626),r=(n(626),new(n(733))),c=document.getElementById("TQ"),l=document.getElementById("main"),u=document.getElementById("create-answer"),a=document.getElementById("create-question"),s=document.getElementById("generateBtn"),d=document.getElementById("saveBtn"),m=["Query","Answer"];var f=0,h=window.indexedDB.open("surgen",5),q=null;function y(e,t,n){if(e){let o=e.transaction(["queries"],"readwrite"),r={questionContent:t,choiceContents:n};o.objectStore("queries").add(r),o.oncomplete=()=>console.log("info: query added to db")}}function p(e,t,n){let o=c.content.firstElementChild.cloneNode(!0),r=o.querySelector(".up"),u=o.querySelector(".bottom"),a=o.querySelector(".question"),s=o.querySelector(".q-query"),d=o.querySelector(".close"),m=l.childElementCount,f=`choice-${m}`,h=document.getElementById("answer-choice"),q=o.querySelector("fieldset");for(i=0;i<n.length;++i){let e=h.content.cloneNode(!0),t=e.querySelector(".q-index"),o=e.querySelector(".q-choice");t.innerText=i,o.innerText=n[i],q.appendChild(e)}o.setAttribute("data-idx",m),r.onclick=()=>function(e){let t=e.previousElementSibling;t&&t.before(e)}(o),u.onclick=()=>function(e){let t=e.nextElementSibling;t&&t.after(e)}(o),d.onclick=function(){this.parentNode.remove()},a.textContent=t,s.value=t;let y=o.querySelectorAll(".q-index"),p=o.querySelectorAll(".q-choice"),g=o.querySelectorAll(".answer");p.forEach(((e,t)=>{e.textContent=n[t],g[t].value=`${y[t].textContent}. ${n[t]}`,e.parentNode.firstElementChild.setAttribute("name",f)})),e.appendChild(o)}function g(){let e=document.querySelectorAll(".wrapper");for(const t of e){let e=t.querySelectorAll(".answer");e[Math.floor(Math.random()*e.length)].checked=!0}}h.onerror=function(e){alert(`Database error: ${e.target.errorCode}`),q=null},h.onsuccess=function(e){let t=(q=e.target.result).transaction(["queries"],"readonly").objectStore("queries").openCursor(),n=[];t.onsuccess=e=>{let t=e.target.result;if(null!=t)n.push(t.value),t.continue();else{let e=document.createDocumentFragment();n.forEach((t=>{p(e,t.questionContent,t.choiceContents)})),l.append(...e.childNodes),console.log("info: cursor fetched all!")}},q.onerror=e=>{alert(e.target.errorCode)}},h.onupgradeneeded=function(e){(q=e.target.result).objectStoreNames.contains("queries")?h.transaction.objectStore("queries"):q.createObjectStore("queries",{autoIncrement:!0})},u.onclick=function(e){const t=document.getElementById("fieldset"),n=document.getElementsByClassName("submit-container")[0],o=document.getElementById("answer-input").content.cloneNode(!0),r=o.querySelector("span"),c=t.querySelectorAll("input[name=answer]").length;r.innerText=""+c,t.insertBefore(o,n)},a.onsubmit=function(e){e.preventDefault();let t=new FormData(a),n=t.get("question"),o=t.getAll("answer");p(l,n,o)},l.onsubmit=function(e){e.preventDefault();let t=new FormData(l),n=0,c=[];for(const e of t.values())n%2||c.push([]),c[c.length-1].push(e),++n;let u=o(c,{header:m});r.file(`${f}.csv`,u),++f},s.onclick=function(){if(l.childElementCount){let e=parseInt(window.prompt("Generate Amount: ","0"));for(let t=0;t<e;++t)g(),l.requestSubmit();r.generateAsync({type:"base64"}).then((e=>{let t=document.createElement("a");t.href="data:application/zip;base64,"+e,t.download="surveys.zip",document.body.appendChild(t),t.click(),document.body.removeChild(t)}))}else alert("You need to have atleast one question!")},d.onclick=async function(){var e;await(e="queries",new Promise(((t,n)=>{let o=q.transaction([e],"readwrite").objectStore(e).clear();o.onsuccess=()=>t(),o.onerror=()=>n()})));for(const{questionContent:e,choiceContents:t}of function(){let e=[];return l.childNodes.forEach((t=>{let n=t.querySelector(".question").textContent,o=t.querySelectorAll(".answer"),r=[];o.forEach((e=>r.push(e.value.slice(3)))),e.push({questionContent:n,choiceContents:r})})),e}())y(q,e,t);alert("Data Saved!")}}},e=>{"use strict";e.O(0,[470,508],(()=>(138,e(e.s=138)))),e.O()}]);
//# sourceMappingURL=main.7cdb60358dd5aefee1d5.js.map