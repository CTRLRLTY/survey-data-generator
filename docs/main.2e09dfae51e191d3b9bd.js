(self.webpackChunkSurveyGenerator=self.webpackChunkSurveyGenerator||[]).push([[179],{138:(e,t,n)=>{const{convertArrayToCSV:o}=n(626),r=(n(626),new(n(733))),c=document.getElementById("TQ"),l=document.getElementById("main"),u=document.getElementById("create-question"),a=document.getElementById("generateBtn"),i=document.getElementById("saveBtn"),s=["Query","Answer"];var d=0,f=window.indexedDB.open("surgen",5),m=null;function h(e,t,n){if(e){let o=e.transaction(["queries"],"readwrite"),r={questionContent:t,choiceContents:n};o.objectStore("queries").add(r),o.oncomplete=()=>console.log("info: query added to db")}}function q(e,t,n){let o=c.content.firstElementChild.cloneNode(!0),r=o.querySelector(".up"),u=o.querySelector(".bottom"),a=o.querySelector(".question"),i=o.querySelector(".q-query"),s=o.querySelectorAll(".q-index"),d=o.querySelectorAll(".q-choice"),f=o.querySelectorAll(".answer"),m=o.querySelector(".close"),h=l.childElementCount,q=`choice-${h}`;o.setAttribute("data-idx",h),r.onclick=()=>function(e){let t=e.previousElementSibling;t&&t.before(e)}(o),u.onclick=()=>function(e){let t=e.nextElementSibling;t&&t.after(e)}(o),m.onclick=function(){this.parentNode.remove()},a.textContent=t,i.value=t,d.forEach(((e,t)=>{e.textContent=n[t],f[t].value=`${s[t].textContent}. ${n[t]}`,e.parentNode.firstElementChild.setAttribute("name",q)})),e.appendChild(o)}function p(){let e=document.querySelectorAll(".wrapper");for(const t of e){let e=t.querySelectorAll(".answer");e[Math.floor(Math.random()*e.length)].checked=!0}}f.onerror=function(e){alert(`Database error: ${e.target.errorCode}`),m=null},f.onsuccess=function(e){let t=(m=e.target.result).transaction(["queries"],"readonly").objectStore("queries").openCursor(),n=[];t.onsuccess=e=>{let t=e.target.result;if(null!=t)n.push(t.value),t.continue();else{let e=document.createDocumentFragment();n.forEach((t=>{q(e,t.questionContent,t.choiceContents)})),l.append(...e.childNodes),console.log("info: cursor fetched all!")}},m.onerror=e=>{alert(e.target.errorCode)}},f.onupgradeneeded=function(e){(m=e.target.result).objectStoreNames.contains("queries")?f.transaction.objectStore("queries"):m.createObjectStore("queries",{autoIncrement:!0})},u.onsubmit=function(e){e.preventDefault();let t=new FormData(u),n=t.get("question"),o=t.getAll("answer");q(l,n,o)},l.onsubmit=function(e){e.preventDefault();let t=new FormData(l),n=0,c=[];for(const e of t.values())n%2||c.push([]),c[c.length-1].push(e),++n;let u=o(c,{header:s});r.file(`${d}.csv`,u),++d},a.onclick=function(){if(l.childElementCount){let e=parseInt(window.prompt("Generate Amount: ","0"));for(let t=0;t<e;++t)p(),l.requestSubmit();r.generateAsync({type:"base64"}).then((e=>{let t=document.createElement("a");t.href="data:application/zip;base64,"+e,t.download="surveys.zip",document.body.appendChild(t),t.click(),document.body.removeChild(t)}))}else alert("You need to have atleast one question!")},i.onclick=async function(){var e;await(e="queries",new Promise(((t,n)=>{let o=m.transaction([e],"readwrite").objectStore(e).clear();o.onsuccess=()=>t(),o.onerror=()=>n()})));for(const{questionContent:e,choiceContents:t}of function(){let e=[];return l.childNodes.forEach((t=>{let n=t.querySelector(".question").textContent,o=t.querySelectorAll(".answer"),r=[];o.forEach((e=>r.push(e.value.slice(3)))),e.push({questionContent:n,choiceContents:r})})),e}())h(m,e,t);alert("Data Saved!")}}},e=>{"use strict";e.O(0,[470,508],(()=>(138,e(e.s=138)))),e.O()}]);
//# sourceMappingURL=main.2e09dfae51e191d3b9bd.js.map