{"version":3,"sources":["webpack://SurveyGenerator/./src/index.js"],"names":["convertArrayToCSV","zip","TQ","document","getElementById","main","createQForm","generateBtn","saveBtn","header","generation","requestdb","window","indexedDB","open","db","insertQuery","questionContent","choiceContents","trans","transaction","query","objectStore","add","oncomplete","console","log","addQuestion","hostElement","TQClone","content","firstElementChild","cloneNode","buttonTop","querySelector","buttonBottom","question","qIndexes","querySelectorAll","choices","answersInput","close","idx","childElementCount","choiceName","setAttribute","onclick","element","sibling","previousElementSibling","before","moveTop","nextElementSibling","after","moveBottom","this","parentNode","remove","textContent","value","forEach","choice","index","appendChild","randomizeAnswer","questionWrappers","w","answers","Math","floor","random","length","checked","onerror","event","alert","target","errorCode","onsuccess","req","result","openCursor","queries","e","cursor","push","continue","fragment","createDocumentFragment","q","append","childNodes","onupgradeneeded","objectStoreNames","contains","createObjectStore","autoIncrement","onsubmit","preventDefault","data","FormData","get","answerList","getAll","acc","stored","entry","values","csvFile","file","amount","parseInt","prompt","i","requestSubmit","generateAsync","type","then","URI","a","createElement","href","download","body","click","removeChild","async","storeName","Promise","resolve","reject","clear","answerNodes","answer","slice","extractMain"],"mappings":"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","file":"main.2e09dfae51e191d3b9bd.js","sourcesContent":["const dbName = \"surgen\";\nconst { convertArrayToCSV } = require('convert-array-to-csv');\nconst converter = require('convert-array-to-csv');\nconst JSZip = require('jszip');\nconst zip = new JSZip();\nconst TQ = document.getElementById('TQ');\nconst main = document.getElementById('main');\nconst createQForm = document.getElementById('create-question');\nconst generateBtn = document.getElementById('generateBtn');\nconst saveBtn = document.getElementById('saveBtn');\nconst header = ['Query', 'Answer'];\n\nvar generation = 0;\nvar requestdb = window.indexedDB.open(dbName, 5); \nvar db = null;\n\nrequestdb.onerror = function(event) {\n  alert(`Database error: ${event.target.errorCode}`);\n  db = null;\n};\n\nrequestdb.onsuccess = function(event) {\n  db = event.target.result;\n  let trans = db.transaction(['queries'], 'readonly');\n  let queriesStore = trans.objectStore('queries');\n  let req = queriesStore.openCursor();\n  let queries = [];\n\n  req.onsuccess = (e) => {\n    let cursor = e.target.result;\n    if (cursor != null) {\n      queries.push(cursor.value);\n      cursor.continue();\n    } else {\n      let fragment = document.createDocumentFragment();\n      queries.forEach(q => {\n        addQuestion(fragment, q.questionContent, q.choiceContents);\n      });\n      main.append(...fragment.childNodes);\n      console.log('info: cursor fetched all!');\n    }\n  }\n  \n  db.onerror = (e) => {\n    alert(e.target.errorCode);\n  };\n};\n\nrequestdb.onupgradeneeded = function(event) {\n  db = event.target.result; \n  let queries = db.objectStoreNames.contains('queries') ? requestdb.transaction.objectStore('queries') : db.createObjectStore('queries', {autoIncrement: true});\n};\n\ncreateQForm.onsubmit = addQHandler;\nmain.onsubmit = onSubmit;\ngenerateBtn.onclick = generateHandler;\nsaveBtn.onclick = saveHandle;\n\nfunction insertQuery(db, questionContent, choiceContents) {\n  if (db) {\n    let trans = db.transaction(['queries'], 'readwrite');\n    let store = trans.objectStore('queries');\n    let query = {questionContent, choiceContents};\n    store.add(query);\n    trans.oncomplete = () => console.log('info: query added to db');\n  }\n}\n\nfunction addQuestion(hostElement, questionContent, choiceContents) {\n  let TQClone = TQ.content.firstElementChild.cloneNode(true);\n  let buttonTop = TQClone.querySelector('.up');\n  let buttonBottom = TQClone.querySelector('.bottom');\n  let question = TQClone.querySelector('.question') \n  let query = TQClone.querySelector('.q-query');\n  let qIndexes = TQClone.querySelectorAll('.q-index');\n  let choices = TQClone.querySelectorAll('.q-choice');\n  let answersInput = TQClone.querySelectorAll('.answer');\n  let close = TQClone.querySelector('.close');\n  let idx = main.childElementCount;\n  let choiceName = `choice-${idx}`;\n\n  TQClone.setAttribute('data-idx', idx);\n  buttonTop.onclick = () => moveTop(TQClone);\n  buttonBottom.onclick = () => moveBottom(TQClone);\n  close.onclick = function() { this.parentNode.remove() };\n\n  question.textContent = questionContent;\n  query.value = questionContent;\n\n  choices.forEach((choice, index) => {\n    choice.textContent = choiceContents[index];\n    answersInput[index].value = `${qIndexes[index].textContent}. ${choiceContents[index]}`;\n    // Name Mangling for each choices\n    choice.parentNode.firstElementChild.setAttribute('name', choiceName);\n  });\n\n  hostElement.appendChild(TQClone);\n}\n\nfunction addQHandler(e) {\n  e.preventDefault();\n\n  let data = new FormData(createQForm);\n\n  let question = data.get('question');\n  let answerList = data.getAll('answer');\n\n  addQuestion(main, question, answerList);\n}\n\nfunction randomizeAnswer() {\n  let questionWrappers = document.querySelectorAll('.wrapper');\n  for(const w of questionWrappers) {\n    let answers = w.querySelectorAll('.answer');\n    let index = Math.floor(Math.random() * answers.length);\n    answers[index].checked = true;\n  }\n}\n\nfunction generateHandler() {\n  if(main.childElementCount) {\n    let amount = parseInt(window.prompt('Generate Amount: ', '0'));\n\n    for(let i = 0; i < amount; ++i) {\n      randomizeAnswer();\n      main.requestSubmit();\n    }\n    zip.generateAsync({type: \"base64\"}).then((URI) => {\n      // Link Injection\n      let a = document.createElement('a');\n      a.href = \"data:application/zip;base64,\"+URI;\n      a.download = \"surveys.zip\";\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n    });\n  } else {\n    alert('You need to have atleast one question!');\n  }\n}\n\nfunction onSubmit(e) {\n  e.preventDefault();\n\n  let data = new FormData(main);\n  let acc = 0;\n  let stored = []\n  for(const entry of data.values()) {\n    if(!(acc % 2)) \n      stored.push([])\n    stored[stored.length - 1].push(entry);\n    ++acc;\n  }\n\n  let csvFile = convertArrayToCSV(stored,{header}); \n  zip.file(`${generation}.csv`, csvFile)\n  ++generation;\n}\n\nfunction moveTop(element) {\n  let sibling = element.previousElementSibling;\n  if(sibling) \n    sibling.before(element);\n  \n}\n\nfunction moveBottom(element) {\n  let sibling = element.nextElementSibling;\n  if(sibling) \n    sibling.after(element);\n}\n\nfunction extractMain() {\n  let queries = [];\n  main.childNodes.forEach(e => {\n    let questionContent = e.querySelector('.question').textContent;\n    let answerNodes = e.querySelectorAll('.answer');\n    let choiceContents = [];\n    answerNodes.forEach((answer) => choiceContents.push(answer.value.slice(3)));\n    queries.push({questionContent, choiceContents});\n  });\n  return queries;\n}\n\nfunction clearData(storeName) {\n  return new Promise((resolve, reject) => {\n    let trans = db.transaction([storeName], 'readwrite');\n    let queriesStore = trans.objectStore(storeName);\n    let req = queriesStore.clear();\n    req.onsuccess = () => resolve();\n    req.onerror = () => reject();\n  });\n}\n\nasync function saveHandle() {\n  await clearData('queries');\n  for (const {questionContent, choiceContents} of extractMain()) \n    insertQuery(db, questionContent, choiceContents);\n  \n\n  alert('Data Saved!');\n}\n"],"sourceRoot":""}